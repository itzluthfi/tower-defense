<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PvP Tower Defense - MySQL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e1e2f 0%, #2d2d44 100%);
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            color: white;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #2d2d44;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .input-field {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: #a78bfa;
            outline: none;
            background: rgba(0, 0, 0, 0.5);
        }

        .btn-primary {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: transform 0.2s, box-shadow 0.2s;
        }


        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(118, 75, 162, 0.4);
        }

        /* Unit & Game Styles */
        .unit-btn {
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .unit-btn:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .unit-btn.selected {
            border: 3px solid #fbbf24;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }

        .role-attacker {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .role-defender {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- 1. AUTH SCREEN (Login/Register) -->
    <div id="authScreen" class="w-full max-w-md glass-panel rounded-2xl p-8 transition-all duration-500">
        <h1
            class="text-4xl font-bold text-center mb-2 tracking-wide text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">
            üè∞ Tower Defense
        </h1>
        <p class="text-center text-gray-400 mb-8 text-sm">PvP Strategy Game</p>

        <!-- Toggle Tabs -->
        <div class="flex bg-black/30 rounded-lg p-1 mb-6">
            <button onclick="toggleAuth('login')" id="tabLogin"
                class="flex-1 py-2 rounded-md font-bold text-sm bg-white/10 text-white transition-all">Login</button>
            <button onclick="toggleAuth('register')" id="tabRegister"
                class="flex-1 py-2 rounded-md font-bold text-sm text-gray-400 hover:text-white transition-all">Register</button>
        </div>

        <!-- Form -->
        <div class="space-y-4">
            <div>
                <label class="text-xs font-bold text-gray-400 uppercase ml-1">Username</label>
                <input type="text" id="authUsername" class="input-field w-full px-4 py-3 rounded-xl mt-1"
                    placeholder="Enter username">
            </div>
            <div>
                <label class="text-xs font-bold text-gray-400 uppercase ml-1">Password</label>
                <input type="password" id="authPassword" class="input-field w-full px-4 py-3 rounded-xl mt-1"
                    placeholder="Enter password">
            </div>

            <button id="btnSubmitAuth" onclick="submitAuth()"
                class="btn-primary w-full py-3 rounded-xl font-bold text-lg mt-4 text-white">
                Login
            </button>
        </div>
        <p id="authMessage" class="text-center text-red-400 text-sm mt-4 min-h-[20px]"></p>
    </div>

    <!-- 2. DASHBOARD SCREEN -->
    <div id="dashboardScreen" class="w-full max-w-5xl glass-panel rounded-3xl p-6 hidden flex-col md:flex-row gap-6">

        <!-- Left Column: Profile & Actions -->
        <div class="w-full md:w-1/3 flex flex-col gap-4">
            <!-- Profile Card -->
            <div class="bg-black/30 rounded-2xl p-6 text-center border border-white/5">
                <div
                    class="w-20 h-20 bg-gradient-to-tr from-purple-500 to-pink-500 rounded-full mx-auto mb-4 flex items-center justify-center text-3xl shadow-lg border-2 border-white/20">
                    üë§
                </div>
                <h2 id="dashUsername" class="text-2xl font-bold text-white mb-1">Player</h2>

                <div
                    class="flex items-center justify-center gap-2 mb-6 bg-yellow-500/10 py-2 rounded-lg border border-yellow-500/20">
                    <span class="text-2xl">üèÜ</span>
                    <span id="dashTrophies" class="text-3xl font-bold text-yellow-400">0</span>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-2 gap-3 text-sm mb-4">
                    <div class="bg-green-500/10 p-3 rounded-lg border border-green-500/20">
                        <div class="text-green-400 font-bold uppercase text-xs">Wins</div>
                        <div id="dashWins" class="text-2xl font-bold">0</div>
                    </div>
                    <div class="bg-red-500/10 p-3 rounded-lg border border-red-500/20">
                        <div class="text-red-400 font-bold uppercase text-xs">Losses</div>
                        <div id="dashLosses" class="text-2xl font-bold">0</div>
                    </div>
                </div>
                <div class="text-xs text-gray-500">Total Matches Played: <span id="dashMatches"
                        class="text-white">0</span></div>
            </div>

            <!-- Action Buttons -->
            <button onclick="showCreateMatch()"
                class="btn-primary w-full py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 text-white hover:scale-[1.02] transition">
                üéÆ Create Room
            </button>
            <button onclick="showJoinMatch()"
                class="bg-gray-700 hover:bg-gray-600 transition w-full py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 text-white hover:scale-[1.02]">
                üö™ Join Room
            </button>

            <button onclick="logout()"
                class="mt-4 w-full py-3 rounded-xl font-bold text-sm text-red-400 border border-red-500/30 hover:bg-red-500/20 transition flex items-center justify-center gap-2">
                ‚¨ÖÔ∏è Logout
            </button>
        </div>

        <!-- Right Column: Leaderboard -->
        <div class="w-full md:w-2/3 bg-black/30 rounded-2xl p-6 border border-white/5 flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold flex items-center gap-2 text-white">
                    üìä Top Players
                </h3>
                <button onclick="requestDashboard()"
                    class="text-xs bg-white/10 hover:bg-white/20 px-3 py-1 rounded text-white transition">Refresh</button>
            </div>

            <div class="overflow-y-auto flex-1 max-h-[400px]">
                <table class="w-full text-left border-collapse table-fixed">
                    <thead class="text-xs text-gray-400 uppercase bg-white/5 sticky top-0 backdrop-blur-md z-10">
                        <tr>
                            <th class="p-3 rounded-tl-lg text-center">Rank</th>
                            <th class="p-3 text-left">Player</th>
                            <th class="p-3 text-right rounded-tr-lg">Trophies</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody" class="text-sm text-gray-200">
                        <tr>
                            <td colspan="3" class="p-4 text-center text-gray-500">Loading leaderboard...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 3. MODALS (Create/Join/Waiting/GameOver) -->

    <!-- Create Room Modal -->
    <div id="createMatchModal"
        class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
        <div class="glass-panel bg-[#1a1a2e] rounded-2xl p-8 max-w-sm w-full mx-4 border border-purple-500/30">
            <h2 class="text-2xl font-bold mb-6 text-center text-white">Select Your Role</h2>
            <div class="grid grid-cols-2 gap-4 mb-6">
                <button onclick="selectCreateRole('attacker')" id="createAttacker"
                    class="role-attacker p-4 rounded-xl text-white font-bold opacity-70 hover:opacity-100 hover:scale-105 transition border-2 border-transparent">
                    ‚öîÔ∏è Attacker
                </button>
                <button onclick="selectCreateRole('defender')" id="createDefender"
                    class="role-defender p-4 rounded-xl text-white font-bold opacity-70 hover:opacity-100 hover:scale-105 transition border-2 border-transparent">
                    üõ°Ô∏è Defender
                </button>
            </div>
            <div class="flex gap-3">
                <button onclick="createMatch()"
                    class="flex-1 btn-primary py-3 rounded-lg font-bold text-white">Start</button>
                <button onclick="backToDashboard()"
                    class="px-6 bg-white/10 hover:bg-white/20 py-3 rounded-lg font-bold text-white">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Join Room Modal -->
    <!-- <div id="joinMatchModal"
        class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
        <div class="glass-panel bg-[#1a1a2e] rounded-2xl p-8 max-w-sm w-full mx-4 border border-blue-500/30">
            <h2 class="text-2xl font-bold mb-6 text-center text-white">Join Room</h2>
            <input type="text" id="roomCodeInput" placeholder="ENTER 6-DIGIT CODE" maxlength="6"
                class="input-field w-full px-4 py-4 rounded-xl mb-6 text-center text-2xl font-bold tracking-widest uppercase text-white placeholder-gray-500">
            <div class="flex gap-3">
                <button onclick="joinMatch()"
                    class="flex-1 btn-primary py-3 rounded-lg font-bold text-white">Join</button>
                <button onclick="backToDashboard()"
                    class="px-6 bg-white/10 hover:bg-white/20 py-3 rounded-lg font-bold text-white">Cancel</button>
            </div>
        </div>
    </div> -->

    <!-- Waiting Modal -->
    <div id="waitingModal"
        class="fixed inset-0 bg-black/90 flex items-center justify-center z-50 hidden backdrop-blur-md">
        <div class="text-center text-white">
            <div class="animate-spin text-6xl mb-6">‚è≥</div>
            <h2 class="text-3xl font-bold mb-2">Waiting for opponent...</h2>
            <div class="bg-white/10 p-6 rounded-2xl mb-6 inline-block min-w-[300px] border border-white/10">
                <div class="text-sm text-gray-400 uppercase tracking-wider mb-2">Room Code</div>
                <div id="displayRoomCode"
                    class="text-5xl font-mono font-bold text-purple-400 tracking-widest select-all">------</div>
            </div>
            <br>
            <button onclick="cancelWaiting()"
                class="bg-red-500/80 hover:bg-red-600 text-white px-8 py-3 rounded-xl font-bold transition">
                Cancel
            </button>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="gameOverModal"
        class="fixed inset-0 bg-black/90 flex items-center justify-center z-50 hidden backdrop-blur-md">
        <div
            class="glass-panel bg-[#1a1a2e] rounded-3xl p-10 max-w-md w-full text-center border-2 border-white/20 transform scale-100">
            <div id="winnerEmoji" class="text-8xl mb-4 animate-bounce">üèÜ</div>
            <h2 id="winnerText"
                class="text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                VICTORY!</h2>
            <div id="gameResult"
                class="bg-white/10 p-6 rounded-xl mb-8 text-left text-sm space-y-2 text-white border border-white/10">
            </div>
            <button onclick="returnToMenu()"
                class="btn-primary w-full py-4 rounded-xl font-bold text-xl shadow-xl text-white">
                Return to Dashboard
            </button>
        </div>
    </div>

    <!-- Join Room Modal -->
    <div id="joinMatchModal"
        class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 hidden backdrop-blur-sm">
        <div
            class="glass-panel bg-[#1a1a2e] rounded-2xl p-8 max-w-2xl w-full mx-4 border border-blue-500/30 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold mb-6 text-center text-white">Join Match</h2>

            <!-- Manual Code Input -->
            <div class="mb-6">
                <label class="text-xs font-bold text-gray-400 uppercase mb-2 block">Enter Room Code</label>
                <input type="text" id="roomCodeInput" placeholder="ENTER 6-DIGIT CODE" maxlength="6"
                    class="input-field w-full px-4 py-4 rounded-xl text-center text-2xl font-bold tracking-widest uppercase text-white placeholder-gray-500">
            </div>

            <div class="my-6 flex items-center gap-4">
                <div class="flex-1 h-px bg-white/10"></div>
                <span class="text-gray-500 text-sm">OR SELECT FROM AVAILABLE MATCHES</span>
                <div class="flex-1 h-px bg-white/10"></div>
            </div>

            <!-- Available Matches Table -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-sm font-bold text-gray-400 uppercase">Available Matches</h3>
                    <button onclick="requestAvailableMatches()"
                        class="text-xs bg-white/10 hover:bg-white/20 px-3 py-1 rounded text-white transition">
                        üîÑ Refresh
                    </button>
                </div>
                <div class="overflow-y-auto max-h-[300px] bg-black/30 rounded-xl border border-white/5">
                    <table class="w-full text-left border-collapse">
                        <thead class="text-xs text-gray-400 uppercase bg-white/5 sticky top-0 backdrop-blur-md z-10">
                            <tr>
                                <th class="p-3">Code</th>
                                <th class="p-3">Creator</th>
                                <th class="p-3">Need</th>
                                <th class="p-3">Time</th>
                                <th class="p-3 text-right">Action</th>
                            </tr>
                        </thead>
                        <tbody id="availableMatchesBody" class="text-sm text-gray-200">
                            <tr>
                                <td colspan="5" class="p-4 text-center text-gray-500">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="joinMatch()" class="flex-1 btn-primary py-3 rounded-lg font-bold text-white">Join with
                    Code</button>
                <button onclick="backToDashboard()"
                    class="px-6 bg-white/10 hover:bg-white/20 py-3 rounded-lg font-bold text-white">Cancel</button>
            </div>
        </div>
    </div>

    <!-- 4. GAME CONTAINER (Canvas & UI) -->
    <div id="gameContainer" class="w-full max-w-[1400px] hidden relative">
        <!-- Top Bar -->
        <div
            class="flex justify-between items-center mb-4 bg-black/40 p-4 rounded-2xl backdrop-blur-sm border border-white/10 text-white">
            <div class="flex items-center gap-4">
                <button onclick="confirmExit()"
                    class="bg-red-500/20 hover:bg-red-500 text-red-300 hover:text-white px-4 py-2 rounded-lg font-bold text-xs transition border border-red-500/30">EXIT</button>
                <div class="font-bold text-xl tracking-wide">PvP Tower Defense</div>
            </div>

            <div class="flex gap-6 text-sm font-bold">
                <div class="bg-gray-800 px-4 py-2 rounded-lg flex items-center gap-2 border border-gray-700">
                    ‚è±Ô∏è <span id="countdown">0:00</span>
                </div>
                <div id="playerRole" class="px-4 py-2 rounded-lg bg-gray-600 border border-gray-500">Spectator</div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Sidebar: Units & Chat -->
            <div class="lg:col-span-1 space-y-4">
                <!-- Unit Info Cards -->
                <div class="bg-black/30 rounded-2xl p-4 border border-white/5 space-y-3">
                    <div
                        class="flex justify-between items-center bg-gradient-to-r from-pink-500/20 to-red-500/20 p-3 rounded-xl border border-pink-500/30">
                        <div>
                            <div class="text-xs text-pink-300 font-bold uppercase">Attacker</div>
                            <div id="attackerName" class="font-bold truncate max-w-[100px] text-white">...</div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-400">Gold</div>
                            <div id="attackerGold" class="text-xl font-bold text-yellow-400">1000</div>
                        </div>
                    </div>

                    <div
                        class="flex justify-between items-center bg-gradient-to-r from-blue-500/20 to-cyan-500/20 p-3 rounded-xl border border-blue-500/30">
                        <div>
                            <div class="text-xs text-cyan-300 font-bold uppercase">Defender</div>
                            <div id="defenderName" class="font-bold truncate max-w-[100px] text-white">...</div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-gray-400">Gold</div>
                            <div id="defenderGold" class="text-xl font-bold text-yellow-400">1000</div>
                        </div>
                    </div>
                    <!-- Base HP Card -->
                    <div class="flex justify-between items-center bg-white/10 p-3 rounded-xl border border-white/20">
                        <div class="text-xs text-gray-400 font-bold uppercase">Base HP</div>
                        <div id="defenderHP" class="font-bold text-2xl text-green-400">100</div>
                    </div>
                </div>

                <!-- Unit Selection Area -->
                <div id="attackerUnits" class="hidden space-y-2">
                    <h3 class="text-sm font-bold text-gray-400 uppercase mb-2 ml-1">Deploy Troops</h3>
                    <button onclick="selectUnit('soldier')" id="unit-soldier"
                        class="unit-btn w-full bg-gray-800 hover:bg-gray-700 p-3 rounded-xl flex justify-between items-center group text-white">
                        <div class="text-left">
                            <div class="font-bold group-hover:text-green-400">ü™ñ Soldier</div>
                            <div class="text-[10px] text-gray-400">Fast & Cheap</div>
                        </div>
                        <div class="text-yellow-400 font-bold">50</div>
                    </button>
                    <button onclick="selectUnit('tank')" id="unit-tank"
                        class="unit-btn w-full bg-gray-800 hover:bg-gray-700 p-3 rounded-xl flex justify-between items-center group text-white">
                        <div class="text-left">
                            <div class="font-bold group-hover:text-gray-400">üöö Tank</div>
                            <div class="text-[10px] text-gray-400">High HP</div>
                        </div>
                        <div class="text-yellow-400 font-bold">150</div>
                    </button>
                    <button onclick="selectUnit('runner')" id="unit-runner"
                        class="unit-btn w-full bg-gray-800 hover:bg-gray-700 p-3 rounded-xl flex justify-between items-center group text-white">
                        <div class="text-left">
                            <div class="font-bold group-hover:text-yellow-400">üèÉ Runner</div>
                            <div class="text-[10px] text-gray-400">Very Fast</div>
                        </div>
                        <div class="text-yellow-400 font-bold">80</div>
                    </button>
                    <button onclick="selectUnit('bomber')" id="unit-bomber"
                        class="unit-btn w-full bg-gray-800 hover:bg-gray-700 p-3 rounded-xl flex justify-between items-center group text-white">
                        <div class="text-left">
                            <div class="font-bold group-hover:text-red-400">üí£ Bomber</div>
                            <div class="text-[10px] text-gray-400">Huge Damage</div>
                        </div>
                        <div class="text-yellow-400 font-bold">200</div>
                    </button>
                </div>

                <div id="defenderUnits" class="hidden space-y-2">
                    <h3 class="text-sm font-bold text-gray-400 uppercase mb-2 ml-1">Build Towers</h3>
                    <button onclick="selectUnit('basic')" id="unit-basic"
                        class="unit-btn w-full bg-gray-800 hover:bg-gray-700 p-3 rounded-xl flex justify-between items-center group text-white">
                        <div class="text-left">
                            <div class="font-bold group-hover:text-blue-400">‚öîÔ∏è Basic</div>
                            <div class="text-[10px] text-gray-400">Balanced</div>
                        </div>
                        <div class="text-yellow-400 font-bold">100</div>
                    </button>
                    <button onclick="selectUnit('sniper')" id="unit-sniper"
                        class="unit-btn w-full bg-gray-800 hover:bg-gray-700 p-3 rounded-xl flex justify-between items-center group text-white">
                        <div class="text-left">
                            <div class="font-bold group-hover:text-red-500">üéØ Sniper</div>
                            <div class="text-[10px] text-gray-400">Long Range</div>
                        </div>
                        <div class="text-yellow-400 font-bold">250</div>
                    </button>
                    <button onclick="selectUnit('rapid')" id="unit-rapid"
                        class="unit-btn w-full bg-gray-800 hover:bg-gray-700 p-3 rounded-xl flex justify-between items-center group text-white">
                        <div class="text-left">
                            <div class="font-bold group-hover:text-green-400">‚ö° Rapid</div>
                            <div class="text-[10px] text-gray-400">Fast Fire</div>
                        </div>
                        <div class="text-yellow-400 font-bold">180</div>
                    </button>
                    <button onclick="selectUnit('splash')" id="unit-splash"
                        class="unit-btn w-full bg-gray-800 hover:bg-gray-700 p-3 rounded-xl flex justify-between items-center group text-white">
                        <div class="text-left">
                            <div class="font-bold group-hover:text-orange-400">üí• Splash</div>
                            <div class="text-[10px] text-gray-400">Area Dmg</div>
                        </div>
                        <div class="text-yellow-400 font-bold">300</div>
                    </button>
                </div>

                <!-- FIX: Chat Box dipindahkan ke sini (Sidebar) -->
                <div class="bg-black/30 rounded-xl p-0 border border-white/10">
                    <div id="messageLog" class="p-3 h-40 overflow-y-auto text-xs space-y-1 scrollbar-hide">
                        <div class="text-gray-400 italic">Connected to server...</div>
                    </div>
                    <div class="flex border-t border-white/10">
                        <input type="text" id="chatInput" placeholder="Chat..."
                            onkeypress="if(event.key==='Enter') sendChat()"
                            class="w-full bg-black/80 text-white px-3 py-2 text-xs rounded-b-xl focus:outline-none placeholder-gray-500">
                    </div>
                </div>
            </div>

            <!-- Game Board -->
            <div class="lg:col-span-3">
                <div class="bg-black/30 p-2 rounded-2xl shadow-2xl border border-white/5 relative">
                    <canvas id="gameCanvas" width="1000" height="700"
                        class="w-full h-auto rounded-xl bg-gray-900 cursor-crosshair"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="game.js"></script>
</body>

</html>